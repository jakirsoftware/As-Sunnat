//https://chatgpt.com/c/67a2c9b2-0e84-8008-9d45-0191c5df5d1c
//https://script.google.com/macros/s/AKfycbxAunWkjXJUAOTFsmMCNokvnsd9gY9QQ6LldWWQtVVuFTR7mWut15zyKG6t5SVI6myOyA/exec

function doGet() {
  return HtmlService.createHtmlOutputFromFile('index');
}

// Fetch titles from Sheet2!A2:A
function getTitles() {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Sheet2");
  var titles = sheet.getRange("A2:A").getValues();
  return titles.filter(function(title) {
    return title[0] != "";
  }).map(function(title) {
    return title[0];
  });
}

// Check if Reference exists in Sheet2!B2:B
function referenceExists(reference) {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Sheet2");
  var references = sheet.getRange("B2:B").getValues();
  for (var i = 0; i < references.length; i++) {
    if (references[i][0] == reference) {
      return true;
    }
  }
  return false;
}

// Submit form data
function submitData(data) {
  // Check if the reference exists
  if (!referenceExists(data.reference)) {
    return "Reference does not exist in Sheet2!";
  }

  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Sheet1");
  var values = sheet.getDataRange().getValues();

  // Check if phone number already exists
  for (var i = 1; i < values.length; i++) {
    if (values[i][2] == data.phone) {
      return "Phone number already exists!";
    }
  }

  // Append data
  sheet.appendRow([data.reference, data.name, data.phone, data.title]);
  return "Data added successfully!";
}
------------------------------------
<!DOCTYPE html>
<html>
  <head>
    <script>
      // Function to fetch the list of titles from Sheet2
      function loadTitles() {
        google.script.run.withSuccessHandler(function(titles) {
          var titleSelect = document.getElementById("title");
          titles.forEach(function(title) {
            var option = document.createElement("option");
            option.text = title;
            titleSelect.add(option);
          });
        }).getTitles();
      }

      function submitForm() {
        var data = {
          title: document.getElementById("title").value,
          reference: document.getElementById("reference").value,
          name: document.getElementById("name").value,
          phone: document.getElementById("phone").value
        };

        google.script.run
          .withSuccessHandler(function(response) {
            document.getElementById("result").innerText = response;

            // Clear form fields if submission is successful
            if (response === "Data added successfully!") {
              document.getElementById("title").value = "";
              document.getElementById("reference").value = "";
              document.getElementById("name").value = "";
              document.getElementById("phone").value = "";
            }
          })
          .submitData(data);
      }

      // Load titles when the page loads
      window.onload = loadTitles;
    </script>
  </head>
  <body>
    <h2>Data Entry Form</h2>

    <label>Title:</label>
    <select id="title" required>
      <option value="">Select Title</option>
    </select><br><br>

    <label>Reference:</label>
    <input type="text" id="reference" required><br><br>
    
    <label>Name:</label>
    <input type="text" id="name" required><br><br>
    
    <label>Phone:</label>
    <input type="text" id="phone" required><br><br>

    <button onclick="submitForm()">Submit</button>

    <p id="result"></p>
  </body>
</html>
